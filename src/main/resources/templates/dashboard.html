<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><title>Dashboard</title><meta charset="UTF-8">
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;background:#f5f7fa;min-height:100vh}
.navbar{background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:15px 20px}
.navbar-content{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
.navbar h1{font-size:20px}.navbar a{color:white;text-decoration:none;padding:8px 14px;border-radius:5px;font-size:14px}
.navbar a:hover{background:rgba(255,255,255,.2)}.navbar-links{display:flex;gap:10px;align-items:center}
.container{max-width:750px;margin:0 auto;padding:40px 20px;display:flex;align-items:center;justify-content:center;min-height:calc(100vh - 60px)}
.card{background:white;padding:50px 60px;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.12);text-align:center;width:100%}
.icon{font-size:72px;margin-bottom:20px}
.card h2{font-size:30px;color:#333;margin-bottom:10px}
.card .sub{color:#666;font-size:17px;margin-bottom:35px;line-height:1.6}
.info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:30px 0}
.info-item{padding:18px;background:#f5f7fa;border-radius:10px}
.info-item .icon2{font-size:28px;margin-bottom:8px}
.info-item .lbl{color:#666;font-size:12px;margin-bottom:4px}
.info-item .val{font-size:22px;font-weight:bold;color:#333}
.instructions{background:#fff8e1;border:2px solid #ffd54f;padding:20px 25px;border-radius:10px;text-align:left;margin:20px 0}
.instructions h4{color:#e65100;margin-bottom:10px}
.instructions ul{margin-left:18px;color:#e65100;line-height:1.9;font-size:14px}
.start-btn{display:inline-block;padding:18px 55px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;text-decoration:none;border-radius:10px;font-size:19px;font-weight:bold;margin-top:20px;transition:all .3s;box-shadow:0 4px 15px rgba(102,126,234,.4)}
.start-btn:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(102,126,234,.6)}
.start-btn.disabled{background:#aaa;pointer-events:none;box-shadow:none}
.alert{padding:12px 18px;border-radius:8px;margin-bottom:20px;font-size:14px}
.alert-error{background:#fee2e2;color:#991b1b;border:1px solid #fca5a5}
.alert-info{background:#e0f2fe;color:#0c4a6e;border:1px solid #7dd3fc}
.loading{display:flex;align-items:center;gap:10px;background:#fff8e1;border:2px solid #ffd54f;padding:15px 20px;border-radius:10px;margin-top:20px;justify-content:center;font-size:14px;color:#b45309}
.spinner{width:18px;height:18px;border:3px solid rgba(180,83,9,.3);border-top-color:#b45309;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.completed-card{background:#dcfce7;border:2px solid #bbf7d0;padding:25px;border-radius:10px;margin-top:20px}
.view-btn{display:inline-block;padding:12px 28px;background:#16a34a;color:white;text-decoration:none;border-radius:8px;font-weight:600;margin-top:12px}
</style></head>
<body>
<div class="navbar"><div class="navbar-content">
  <h1>üìä Trading Experiment Platform</h1>
  <div class="navbar-links">
    <span style="opacity:.8;font-size:13px" th:text="${user.fullName}"></span>
    <span th:if="${user.role == 'ADMIN'}">
      <a href="/admin/dashboard" style="background:rgba(220,38,38,.4)">üë®‚Äçüíº Admin</a>
    </span>
    <a href="/logout">Logout</a>
  </div>
</div></div>

<div class="container">

  <!-- Completed -->
  <div class="card" th:if="${experimentCompleted}">
    <div class="icon">‚úÖ</div>
    <h2>Experiment Complete!</h2>
    <p class="sub">Thank you for participating. Your results have been recorded.</p>
    <div class="completed-card">
      <strong style="color:#166534">üéâ All 100 decisions completed!</strong>
      <p style="color:#166534;margin-top:6px;font-size:14px">You can view your full results and performance summary below.</p>
      <a href="/experiment/summary" class="view-btn">View My Results</a>
    </div>
  </div>

  <!-- Can start -->
  <div class="card" th:if="${canStartExperiment}">
    <div class="icon">üìà</div>
    <h2>Welcome, <span th:text="${user.fullName}">User</span>!</h2>
    <p class="sub">You're about to begin the Stock Trading Experiment.</p>

    <div th:if="${error}"   class="alert alert-error" th:text="${error}"></div>
    <div th:if="${info}"    class="alert alert-info"  th:text="${info}"></div>

    <div class="info-grid">
      <div class="info-item"><div class="icon2">üéØ</div><div class="lbl">Total Decisions</div><div class="val">100</div></div>
      <div class="info-item"><div class="icon2">üìä</div><div class="lbl">Stocks to Trade</div><div class="val">10</div></div>
      <div class="info-item"><div class="icon2">‚è±Ô∏è</div><div class="lbl">Time Limit</div><div class="val">2 hrs</div></div>
    </div>

    <div class="instructions">
      <h4>How It Works</h4>
      <ul>
        <li><strong>10 Stocks, 10 Days each</strong> ‚Äî 100 total trading decisions</li>
        <li><strong>Three actions:</strong> BUY (10 shares), SELL (10 shares), or HOLD</li>
        <li><strong>Fresh ‚Çπ1,00,000</strong> capital at the start of each stock</li>
        <li><strong>Historical data revealed day by day</strong> ‚Äî you cannot see the future</li>
        <li><strong>2-hour time limit</strong> ‚Äî complete all 100 decisions within this time</li>
        <li><strong>You can exit early</strong> ‚Äî your progress is always saved</li>
      </ul>
    </div>

    <!-- Ready to start -->
    <div th:if="${experimentReady}">
      <a href="/experiment/start" class="start-btn">‚ñ∂ Begin Experiment</a>
    </div>

    <!-- Still loading -->
    <div class="loading" th:unless="${experimentReady}">
      <div class="spinner"></div>
      <span>Setting up experiment stocks (<span th:text="${stockCount}">0</span>/10)‚Ä¶ Please wait, refreshing automatically‚Ä¶</span>
    </div>
  </div>

</div>

<script th:if="${!experimentReady and canStartExperiment}">
  setTimeout(function(){ location.reload(); }, 8000);
</script>
</body></html>
